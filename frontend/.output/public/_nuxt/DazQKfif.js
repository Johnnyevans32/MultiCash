import{_ as ee}from"./CMp65wxY.js";import{_ as te}from"./CvmaWrLj.js";import{_ as ne}from"./B6uVtycy.js";import{_ as ae}from"./BrOrGAHD.js";import{_ as oe}from"./Cu3int81.js";import{_ as se}from"./Czrw1GKb.js";import{_ as le}from"./DIp1uth1.js";import{_ as ie}from"./B8cuFe5d.js";import{d as re,f as ce}from"./BIfFRkhF.js";import{e as de,z as ue,y as me,r as l,s as pe,I as z,g as W,D as fe,_ as ye,c as d,a as s,b as o,q as G,G as v,F as P,v as H,w,m as ge,o as i,C as be,t as u,H as R,E as ve}from"./CDC5foPa.js";import{u as we}from"./CEedSPwL.js";import{u as he}from"./gh49L7wh.js";import"./CybuPCj8.js";import"./CXSCOM6V.js";import"./CaIJJZHX.js";import"./DWg-mp3v.js";const Be=de({async setup(){we({title:"Send",ogTitle:"Send"}),ue(async()=>{await Promise.all([U(),I(),x()])});const{$api:e}=me(),n=l(!1),A=l(""),{banks:K,wallets:N}=pe(z()),{setWallets:O,setBanks:E}=z(),r=l(""),{withLoadingPromise:p}=he(),h=W(()=>re(K.value,"currency")),f=W(()=>N.value.filter(a=>a.walletCurrency.withdrawalEnabled).map(a=>a.currency)),B=W(()=>N.value.map(a=>a.currency)),m=l(""),V=l(!1),I=async()=>{await p(e.walletService.fetchWallets().then(a=>{m.value=a.filter(L=>L.walletCurrency.withdrawalEnabled)[0].currency,O(a)}),V)},t=l("bankaccount"),y=l(),g=l(!1),b=l(""),_=async()=>{try{if(g.value=!0,t.value==="bankaccount"){const a=await e.paymentService.verifyAccountNumber({accountNumber:A.value,bankId:r.value});b.value=a.accountName}await e.walletService.createBeneficiary({beneficiaryType:t.value,...t.value==="bankaccount"?{accountNumber:A.value,accountName:b.value,bank:r.value}:{beneficiaryTag:y.value}}),n.value=!1,x(),fe({type:"success",title:"beneficiary created"})}finally{g.value=!1}},T=a=>{m.value=a},$=a=>{r.value=a},C=l([]),k=l(!1),x=async()=>{await p(e.walletService.fetchBeneficiaries().then(a=>{C.value=a}),k)},U=async()=>{const a=await e.paymentService.fetchBanks();E(a)},M=l(""),S=l(100),c=l(),j=l(""),D=l(!1),Y=l(!1),J=async()=>{var a;c.value&&await p(e.walletService.withdraw({note:M.value,amount:S.value,beneficiary:(a=c.value)==null?void 0:a.id,password:j.value,currency:m.value}).then(()=>{F.value=!1,Y.value=!0}),D)},F=l(!1),Q=a=>{c.value=a,F.value=!0},X=W(()=>{var L,q;const a=((q=(L=c.value)==null?void 0:L.bank)==null?void 0:q.currency)||m.value;return N.value.find(Z=>Z.currency===a)});return{selectedCurrency:m,accountNumber:A,addAccountModal:n,createBeneficiary:_,groupedBanksByCurrency:h,withdrawableCurrencies:f,handleCurrencyChange:T,isFetchWalletLoading:V,selectedBankId:r,handleBankChange:$,isCreateBeneficiaryLoading:g,isFetchBeneficiariesLoading:k,beneficiaries:C,withdrawalModal:F,selectedBeneficiary:c,amount:S,note:M,password:j,isWithdrawLoading:D,withdraw:J,openWithdrawalModal:Q,wallet:X,successModal:Y,accountName:b,beneficiaryType:t,beneficiaryTag:y,allCurrencies:B}}}),Ce={class:"border-b-[1px] border-base text-left py-2"},ke={class:"flex items-center justify-between"},xe={key:0},Me={key:1},Se={key:2,class:"flex flex-col gap-2"},Ae=["onClick"],Ne={class:"flex space-x-3 items-center"},Ve={class:"flex flex-col text-left"},_e={class:"md:text-sm text-xs line-clamp-1"},Te={class:"md:text-sm text-xs line-clamp-1"},$e={class:"flex flex-col gap-4"},Ue={key:0,class:"flex flex-col gap-4"},Le={key:2,class:"text-sm text-red-600"},We={class:"flex flex-col gap-4"},Ee={key:0,class:"flex items-center gap-2"},Ie={class:"text-sm md:text-xs"},Fe={class:"text-xs md:text-sm"},Pe={key:1,class:"flex flex-col gap-4"},Ke={class:"flex items-center gap-2"},Oe={class:"text-sm md:text-xs"},je={class:"text-xs md:text-sm"},De={class:"flex flex-col gap-4 items-center"},Ye={class:"text-sm"};function qe(e,n,A,K,N,O){const E=ee,r=te,p=ge("font-awesome-icon"),h=ne,f=ae,B=oe,m=se,V=le,I=ie;return i(),d(P,null,[s("div",Ce,[o(E,{mainPage:"Send"})]),s("div",ke,[n[13]||(n[13]=s("h1",{class:"text-xl font-bold"},"Beneficiaries",-1)),e.isFetchWalletLoading?v("",!0):(i(),G(r,{key:0,text:"Add Beneficiary",imageType:"icon",image:"fa-solid fa-plus",onBtnAction:n[0]||(n[0]=t=>e.addAccountModal=!0),customCss:"justify-self-end"}))]),e.isFetchBeneficiariesLoading?(i(),d("div",xe,[(i(),d(P,null,H(2,t=>s("div",{key:t,class:"p-5 cursor-progress flex mb-2 items-center h-16 justify-between rounded-xl text-base bg-lightbase border-[1px] border-base animate-pulse"},n[14]||(n[14]=[be('<div class="flex space-x-2 items-center"><div class="bg-base h-10 w-10 rounded-xl"></div><div class="flex flex-col gap-2"><div class="h-2 w-20 bg-base rounded"></div><div class="h-2 w-28 bg-base rounded"></div></div></div><div class="h-2 w-12 bg-base rounded"></div>',2)]))),64))])):e.beneficiaries.length?(i(),d("div",Se,[(i(!0),d(P,null,H(e.beneficiaries,t=>(i(),d("div",{key:t.id,class:"cursor-pointer p-5 flex items-center h-16 justify-between rounded-xl bg-lightbase",onClick:y=>e.openWithdrawalModal(t)},[s("div",Ne,[o(h,{image:t.type==="platform"?t.beneficiaryUser.profileImage:t.bank.logo,alt:t.type==="platform"?t.beneficiaryUser.tag:t.bank.name},null,8,["image","alt"]),s("div",Ve,[s("span",_e,u(t.type==="platform"?t.beneficiaryUser.name:t.accountName),1),s("span",Te,u(t.type==="platform"?`@${t.beneficiaryUser.tag}`:`${t.accountNumber} (${t.bank.name})`),1)])]),o(p,{icon:"arrow-right"})],8,Ae))),128))])):(i(),d("div",Me,[o(p,{class:"text-7xl mb-5",icon:"user-group"}),n[15]||(n[15]=s("p",null,"Nothing to see here",-1)),n[16]||(n[16]=s("p",null,"your beneficiaries will appear here once added.",-1))])),o(m,{open:e.addAccountModal,title:"Add a beneficiary",onChangeModalStatus:n[5]||(n[5]=t=>{e.addAccountModal=t})},{content:w(()=>[s("div",$e,[o(f,{title:"Select beneficiary type",selected:e.beneficiaryType,options:["platform","bankaccount"],onChangeOption:n[1]||(n[1]=t=>{e.beneficiaryType=t})},null,8,["selected"]),e.beneficiaryType==="bankaccount"?(i(),d("div",Ue,[o(f,{title:"Select currency",selected:e.selectedCurrency,options:e.withdrawableCurrencies,onChangeOption:e.handleCurrencyChange,placeholder:"-- Please select a currency --"},null,8,["selected","options","onChangeOption"]),o(f,{title:"Select bank",selected:e.selectedBankId,options:e.groupedBanksByCurrency[e.selectedCurrency],onChangeOption:e.handleBankChange,labelKey:"name",placeholder:"-- Please select a bank --",valueKey:"id"},null,8,["selected","options","onChangeOption"]),o(B,{modelValue:e.accountNumber,"onUpdate:modelValue":n[2]||(n[2]=t=>e.accountNumber=t),placeholder:"1234567890",title:"Enter account number","input-type":"text",onKeyup:R(e.createBeneficiary,["enter"])},null,8,["modelValue","onKeyup"])])):v("",!0),e.beneficiaryType==="platform"?(i(),G(B,{key:1,modelValue:e.beneficiaryTag,"onUpdate:modelValue":n[3]||(n[3]=t=>e.beneficiaryTag=t),placeholder:"Enter user tag (e.g., john_doe)",title:"Enter user tag","input-type":"text",onKeyup:R(e.createBeneficiary,["enter"])},null,8,["modelValue","onKeyup"])):v("",!0),e.accountName?(i(),d("span",Le,"Account Name: "+u(e.accountName),1)):v("",!0)])]),footer:w(()=>[o(r,{text:"Cancel",onBtnAction:n[4]||(n[4]=t=>e.addAccountModal=!1),"custom-css":"bg-red-600 w-full text-white"}),o(r,{text:"Add beneficiary",onBtnAction:e.createBeneficiary,"custom-css":"!bg-blue-600 w-full text-white",loading:e.isCreateBeneficiaryLoading},null,8,["onBtnAction","loading"])]),_:1},8,["open"]),o(m,{open:e.withdrawalModal,title:"Send money to beneficiary",onChangeModalStatus:n[10]||(n[10]=t=>{e.withdrawalModal=t})},{content:w(()=>{var t,y,g,b,_,T,$,C,k,x,U,M,S;return[s("div",We,[((t=e.selectedBeneficiary)==null?void 0:t.type)==="bankaccount"?(i(),d("div",Ee,[o(h,{image:(y=e.selectedBeneficiary.bank)==null?void 0:y.logo,alt:(g=e.selectedBeneficiary.bank)==null?void 0:g.name,type:"image"},null,8,["image","alt"]),s("div",null,[s("p",Ie,u((b=e.selectedBeneficiary)==null?void 0:b.accountName),1),s("p",Fe,u((_=e.selectedBeneficiary)==null?void 0:_.accountNumber)+" ("+u((T=e.selectedBeneficiary)==null?void 0:T.bank.name)+") ",1)])])):v("",!0),(($=e.selectedBeneficiary)==null?void 0:$.type)==="platform"?(i(),d("div",Pe,[s("div",Ke,[o(h,{image:(C=e.selectedBeneficiary.beneficiaryUser)==null?void 0:C.profileImage,alt:"avatar",type:"image"},null,8,["image"]),s("div",null,[s("p",Oe,u((k=e.selectedBeneficiary)==null?void 0:k.beneficiaryUser.name),1),s("p",je," @"+u((x=e.selectedBeneficiary)==null?void 0:x.beneficiaryUser.tag),1)])]),o(f,{title:"Select currency",selected:e.selectedCurrency,options:e.allCurrencies,onChangeOption:e.handleCurrencyChange,placeholder:"-- Please select a currency --"},null,8,["selected","options","onChangeOption"])])):v("",!0),o(V,{modelValue:e.amount,"onUpdate:modelValue":n[6]||(n[6]=c=>e.amount=c),title:"Enter amount",currency:(U=e.wallet)==null?void 0:U.currency,balance:(M=e.wallet)==null?void 0:M.availableBalance,max:(S=e.wallet)==null?void 0:S.availableBalance,min:0},null,8,["modelValue","currency","balance","max"]),o(B,{inputType:"password",modelValue:e.password,"onUpdate:modelValue":n[7]||(n[7]=c=>e.password=c),title:"Enter your password",placeholder:"password"},null,8,["modelValue"]),o(I,{modelValue:e.note,"onUpdate:modelValue":n[8]||(n[8]=c=>e.note=c),placeholder:"e.g., Payment for services",title:"Add note"},null,8,["modelValue"])])]}),footer:w(()=>[o(r,{text:"Cancel",onBtnAction:n[9]||(n[9]=t=>e.withdrawalModal=!1),"custom-css":"bg-red-600 w-full text-white"}),o(r,{text:"Send",onBtnAction:e.withdraw,"custom-css":"!bg-blue-600 w-full text-white",loading:e.isWithdrawLoading},null,8,["onBtnAction","loading"])]),_:1},8,["open"]),o(m,{open:e.successModal,title:"Withdrawal Submitted",onChangeModalStatus:n[12]||(n[12]=t=>{e.successModal=t})},{content:w(()=>{var t;return[s("div",De,[o(p,{icon:"check-circle",class:"text-7xl text-green-600"}),n[17]||(n[17]=s("p",{class:"text-xl font-bold"},"Your withdrawal has been submitted!",-1)),s("p",Ye," You have successfully placed a withdrawal of "+u(("formatMoney"in e?e.formatMoney:ve(ce))(e.amount))+" "+u((t=e.wallet)==null?void 0:t.currency)+" to your beneficiary. ",1)])]}),footer:w(()=>[o(r,{text:"Close",onBtnAction:n[11]||(n[11]=t=>e.successModal=!1),"custom-css":"bg-base w-full text-base"})]),_:1},8,["open"])],64)}const rt=ye(Be,[["render",qe]]);export{rt as default};
